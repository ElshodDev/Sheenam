@using Microsoft.AspNetCore.Components.Authorization
@inject AuthenticationStateProvider AuthStateProvider
@inject NavigationManager Navigation
@inject Services.TokenStorageService TokenStorage

<div class="sidebar-container">
    <div class="brand-box">
        <div class="logo-circle">
            🏠
        </div>
        <div class="brand-info">
            <h3>Sheenam</h3>
            <span>Dashboard v1.0</span>
        </div>
    </div>

    <AuthorizeView>
        <Authorized>
            <div class="profile-card">
                <div class="profile-avatar">
                    @GetUserInitials(context)
                </div>
                <div class="profile-text">
                    <span class="name">@GetFullName(context)</span>
                    <span class="role">@GetUserRole(context)</span>
                </div>
            </div>
        </Authorized>
    </AuthorizeView>

    <nav class="nav-scroll">
        <div class="menu-label">ASOSIY</div>
        <div class="nav-item-wrapper">
            <NavLink class="modern-nav-link" href="/" Match="NavLinkMatch.All">
                <span class="icon">📊</span>
                <span class="label">Dashboard</span>
                @if (homesCount > 0)
                {
                    <span class="badge-pill">@homesCount</span>
                }
            </NavLink>
        </div>

        <div class="menu-label">BOSHQARUV</div>
        <div class="nav-item-wrapper">
            <NavLink class="modern-nav-link" href="/hosts">
                <span class="icon">👨‍💼</span>
                <span class="label">Hostlar</span>
                @if (hostsCount > 0)
                {
                    <span class="badge-pill success">@hostsCount</span>
                }
            </NavLink>
        </div>

        <div class="nav-item-wrapper">
            <NavLink class="modern-nav-link" href="/homes">
                <span class="icon">🏡</span>
                <span class="label">Uylar</span>
                @if (homesCount > 0)
                {
                    <span class="badge-pill info">@homesCount</span>
                }
            </NavLink>
        </div>

        <div class="nav-item-wrapper">
            <NavLink class="modern-nav-link" href="/guests">
                <span class="icon">👥</span>
                <span class="label">Mehmonlar</span>
                @if (guestsCount > 0)
                {
                    <span class="badge-pill warning">@guestsCount</span>
                }
            </NavLink>
        </div>

        <div class="nav-item-wrapper">
            <NavLink class="modern-nav-link" href="/home-requests">
                <span class="icon">✉️</span>
                <span class="label">So'rovlar</span>
                @if (requestsCount > 0)
                {
                    <span class="badge-pill danger">@requestsCount</span>
                }
            </NavLink>
        </div>

        <div class="menu-gap"></div>

        <div class="menu-label">TIZIM</div>
        <div class="nav-item-wrapper">
            <button class="modern-nav-link btn-reset" @onclick="() => OnShowHelpModal.InvokeAsync(true)">
                <span class="icon">❓</span>
                <span class="label">Yordam</span>
            </button>
        </div>

        <AuthorizeView>
            <Authorized>
                <div class="nav-item-wrapper">
                    <button class="modern-nav-link logout-style btn-reset" @onclick="HandleLogout">
                        <span class="icon">🚪</span>
                        <span class="label">Chiqish</span>
                    </button>
                </div>
            </Authorized>
            <NotAuthorized>
                <div class="nav-item-wrapper">
                    <NavLink class="modern-nav-link" href="/login">
                        <span class="icon">🔐</span>
                        <span class="label">Kirish</span>
                    </NavLink>
                </div>
            </NotAuthorized>
        </AuthorizeView>
    </nav>
</div>

@code {
    [Parameter] public EventCallback<bool> OnShowHelpModal { get; set; }

    // Mock Data
    private int hostsCount = 3;
    private int homesCount = 4;
    private int guestsCount = 3;
    private int requestsCount = 2;

    private async Task HandleLogout()
    {
        await TokenStorage.RemoveTokenAsync();
        Navigation.NavigateTo("/login", forceLoad: true);
    }

    private string GetUserInitials(AuthenticationState context) => "ED";
    private string GetFullName(AuthenticationState context) => "Elshod Developer";
    private string GetUserRole(AuthenticationState context) => "Administrator";
}